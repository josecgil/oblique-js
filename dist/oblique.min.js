(function(){var DataModelVariable,DirectiveCollection,DirectiveProcessor,Element,Error,Memory,Oblique,ObliqueError,Template,TemplateFactory,TimedDOMObserver,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),this.ObliqueNS=this.ObliqueNS||{},DataModelVariable=function(){function DataModelVariable(_expression){this._expression=_expression,this._firstEqualPosition=this._expression.indexOf("="),this.name=this._getVariableName(),this.isSet=this._isSet()}return DataModelVariable.prototype._getVariableName=function(){var parts,variableName;return-1===this._firstEqualPosition?this._expression:(parts=this._expression.split("="),variableName=parts[0].replace("var ","").trim(),""===variableName?void 0:variableName)},DataModelVariable.prototype._isSet=function(){var nextChar;return-1===this._firstEqualPosition?!1:(nextChar=this._expression.substr(this._firstEqualPosition+1,1),"="===nextChar?!1:!0)},DataModelVariable}(),ObliqueNS.DataModelVariable=DataModelVariable,this.ObliqueNS=this.ObliqueNS||{},DirectiveCollection=function(){function DirectiveCollection(){this.directives=[],this._directivesByName={}}return DirectiveCollection.prototype.count=function(){return this.directives.length},DirectiveCollection.prototype._isAFunction=function(memberToTest){return"function"==typeof memberToTest},DirectiveCollection.NOT_A_FUNCTION_CLASS_ERROR_MESSAGE="registerDirective must be called with a Directive 'Constructor/Class'",DirectiveCollection.prototype._throwErrorIfDirectiveIsNotValid=function(directiveName,directive){if(!directiveName||"string"!=typeof directiveName)throw new ObliqueNS.Error("registerDirective must be called with a string directiveName");if(!this._isAFunction(directive))throw new ObliqueNS.Error(ObliqueNS.DirectiveCollection.NOT_A_FUNCTION_CLASS_ERROR_MESSAGE)},DirectiveCollection.prototype.add=function(directiveName,directiveFn){return this._throwErrorIfDirectiveIsNotValid(directiveName,directiveFn),this.directives.push(directiveFn),this._directivesByName[directiveName]=directiveFn},DirectiveCollection.prototype.at=function(index){return this.directives[index]},DirectiveCollection.prototype.getDirectiveByName=function(directiveName){return this._directivesByName[directiveName]},DirectiveCollection}(),ObliqueNS.DirectiveCollection=DirectiveCollection,this.ObliqueNS=this.ObliqueNS||{},DataModelVariable=ObliqueNS.DataModelVariable,DirectiveProcessor=function(){function DirectiveProcessor(){return this===window?new DirectiveProcessor:DirectiveProcessor._singletonInstance?DirectiveProcessor._singletonInstance:(DirectiveProcessor._singletonInstance=this,this._throwErrorIfJQueryIsntLoaded(),this._directiveCollection=new ObliqueNS.DirectiveCollection,this._timedDOMObserver=this._createTimedDOMObserver(DirectiveProcessor.DEFAULT_INTERVAL_MS),this._memory=new ObliqueNS.Memory,void jQuery(document).ready(function(_this){return function(){return _this._applyDirectivesInDOM(),_this._timedDOMObserver.observe()}}(this)))}return DirectiveProcessor.DEFAULT_INTERVAL_MS=500,DirectiveProcessor.prototype._throwErrorIfJQueryIsntLoaded=function(){if(!window.jQuery)throw new Error("DirectiveProcessor needs jQuery to work")},DirectiveProcessor.prototype._createTimedDOMObserver=function(intervalInMs){var observer;return observer=new ObliqueNS.TimedDOMObserver(intervalInMs),observer.onChange(function(_this){return function(){return _this._applyDirectivesInDOM()}}(this)),observer},DirectiveProcessor._isApplyingDirectivesInDOM=!1,DirectiveProcessor.prototype._applyDirectivesInDOM=function(){if(!this._isApplyingDirectivesInDOM){this._isApplyingDirectivesInDOM=!0;try{return $("*[data-ob-directive]").each(function(_this){return function(index,DOMElement){var directiveAttrValue,obElement;return obElement=new ObliqueNS.Element(DOMElement),directiveAttrValue=obElement.getAttributeValue("data-ob-directive"),directiveAttrValue?_this._processDirectiveElement(obElement,directiveAttrValue):void 0}}(this))}finally{this._isApplyingDirectivesInDOM=!1}}},DirectiveProcessor.prototype._processDirectiveElement=function(obElement,directiveAttrValue){var directive,directiveData,directiveName,_i,_len,_ref,_results;for(_ref=directiveAttrValue.split(","),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)if(directiveName=_ref[_i],directiveName=directiveName.trim(),!obElement.hasFlag(directiveName)){if(directive=this._directiveCollection.getDirectiveByName(directiveName),!directive)throw new ObliqueNS.Error("There is no "+directiveName+" directive registered");obElement.setFlag(directiveName),directiveData={domElement:obElement.getDOMElement(),jQueryElement:obElement.getjQueryElement(),model:this._getDirectiveModel(obElement),params:this._getParams(obElement)},_results.push(new directive(directiveData))}return _results},DirectiveProcessor.prototype._getParams=function(obElement){var dataParamsExpr,e;if(dataParamsExpr=obElement.getAttributeValue("data-ob-params"),!dataParamsExpr)return void 0;try{return jQuery.parseJSON(dataParamsExpr)}catch(_error){return e=_error,this._throwError(""+obElement.getHtml()+": data-ob-params parse error: "+e.message)}},DirectiveProcessor.prototype._getDirectiveModel=function(___obElement){var Model,e,___dataModelExpr,___dataModelVariable,___directiveModel,___variableName,___variableValue;if(Model=Oblique().getModel(),___dataModelExpr=___obElement.getAttributeValue("data-ob-model"),void 0===___dataModelExpr)return void 0;try{return eval(this._memory.localVarsScript()),___directiveModel=eval(___dataModelExpr),___dataModelVariable=new DataModelVariable(___dataModelExpr),___dataModelVariable.isSet&&(___variableName=___dataModelVariable.name,___variableValue=eval(___variableName),this._memory.setVar(___variableName,___variableValue),___directiveModel=___variableValue),___directiveModel||this._throwError(""+___obElement.getHtml()+": data-ob-model expression is undefined"),___directiveModel}catch(_error){return e=_error,this._throwError(""+___obElement.getHtml()+": data-ob-model expression error: "+e.message)}},DirectiveProcessor.prototype._throwError=function(errorMessage){return Oblique().triggerOnError(new ObliqueNS.Error(errorMessage))},DirectiveProcessor.prototype.getIntervalTimeInMs=function(){return this._timedDOMObserver.getIntervalInMs()},DirectiveProcessor.prototype.setIntervalTimeInMs=function(newIntervalTimeInMs){if(0>=newIntervalTimeInMs)throw new ObliqueNS.Error("IntervalTime must be a positive number");return this._timedDOMObserver.destroy(),this._timedDOMObserver=this._createTimedDOMObserver(newIntervalTimeInMs),this._timedDOMObserver.observe()},DirectiveProcessor.prototype.registerDirective=function(directiveName,directiveConstructorFn){return this._directiveCollection.add(directiveName,directiveConstructorFn)},DirectiveProcessor.prototype.destroy=function(){return this._timedDOMObserver.destroy(),DirectiveProcessor._singletonInstance=void 0},DirectiveProcessor}(),ObliqueNS.DirectiveProcessor=DirectiveProcessor,this.Oblique=DirectiveProcessor,this.ObliqueNS=this.ObliqueNS||{},Element=function(){function Element(DOMElement){this._jQueryElement=jQuery(DOMElement)}return Element.prototype.getDOMElement=function(){return this._jQueryElement.get(0)},Element.prototype.getjQueryElement=function(){return this._jQueryElement},Element.prototype.isTag=function(){return Element._isTag(this._DOMElement)},Element.prototype.matchCSSExpression=function(cssExpression){return this._jQueryElement.is(cssExpression)},Element.prototype.setFlag=function(flagName){return this._jQueryElement.data(flagName,!0)},Element.prototype.unsetFlag=function(flagName){return this._jQueryElement.removeData(flagName)},Element.prototype.hasFlag=function(flagName){return this._jQueryElement.data(flagName)},Element.prototype.hasAttribute=function(attributeName){var attrValue;return attrValue=this.getAttributeValue(attributeName),void 0===attrValue?!1:!0},Element.prototype.getAttributeValue=function(attributeName){return this._jQueryElement.attr(attributeName)},Element.prototype.eachDescendant=function(callbackOnDOMElement){return Element._traverse(this.getDOMElement(),callbackOnDOMElement)},Element._isTag=function(DOMElement){return 1===DOMElement.nodeType},Element._traverse=function(parentElement,callbackOnDOMElement){var child,currentElement,elementsToTraverse,_results;for(elementsToTraverse=[],Element._isTag(parentElement)&&elementsToTraverse.push(parentElement),callbackOnDOMElement(parentElement),_results=[];elementsToTraverse.length>0;)currentElement=elementsToTraverse.pop(),_results.push(function(){var _i,_len,_ref,_results1;for(_ref=currentElement.children,_results1=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],Element._isTag(child)?(elementsToTraverse.push(child),_results1.push(callbackOnDOMElement(child))):_results1.push(void 0);return _results1}());return _results},Element.prototype.getHtml=function(){return this.getDOMElement().outerHTML},Element}(),ObliqueNS.Element=Element,this.ObliqueNS=this.ObliqueNS||{},Error=function(){function Error(message){return this.message=message,this===window?new Error(this.message):void(this.name="Oblique.Error")}return Error}(),ObliqueNS.Error=Error,this.ObliqueNS=this.ObliqueNS||{},Memory=function(){function Memory(){this._vars={}}return Memory.prototype.setVar=function(name,value){if("Model"===name)throw new ObliqueNS.Error("Can't create a variable named 'Model', is a reserved word");return this._vars[name]=value},Memory.prototype.getVar=function(name){return this._vars[name]},Memory.prototype.localVarsScript=function(){var script,variableName,variableValue,_ref;script="",_ref=this._vars;for(variableName in _ref)__hasProp.call(_ref,variableName)&&(variableValue=_ref[variableName],script+="var "+variableName+'=this._memory.getVar("'+variableName+'");');return script},Memory}(),ObliqueNS.Memory=Memory,this.ObliqueNS=this.ObliqueNS||{},Oblique=function(){function Oblique(){return this===window?new Oblique:Oblique._singletonInstance?Oblique._singletonInstance:(Oblique._singletonInstance=this,this.directiveProcessor=new ObliqueNS.DirectiveProcessor,this.templateFactory=new ObliqueNS.TemplateFactory,void(this._onErrorCallbacks=[]))}return Oblique.DEFAULT_INTERVAL_MS=500,Oblique.prototype.getIntervalTimeInMs=function(){return this.directiveProcessor.getIntervalTimeInMs()},Oblique.prototype.setIntervalTimeInMs=function(newIntervalTimeInMs){return this.directiveProcessor.setIntervalTimeInMs(newIntervalTimeInMs)},Oblique.prototype.registerDirective=function(directiveName,directiveConstructorFn){return this.directiveProcessor.registerDirective(directiveName,directiveConstructorFn)},Oblique.prototype.destroy=function(){var e;this.directiveProcessor.destroy();try{return delete Oblique._singletonInstance}catch(_error){return e=_error,Oblique._singletonInstance=void 0}},Oblique.prototype.setModel=function(_model){this._model=_model},Oblique.prototype.getModel=function(){return this._model},Oblique.prototype.hasModel=function(){return this._model?!0:!1},Oblique.prototype.renderHtml=function(url,model){var template;if(void 0===Handlebars)throw new ObliqueNS.Error("Oblique().renderHtml() needs handlebarsjs loaded to work");return template=this.templateFactory.createFromUrl(url),template.renderHTML(model)},Oblique.prototype.onError=function(onErrorCallback){return this._onErrorCallbacks.push(onErrorCallback)},Oblique.prototype.triggerOnError=function(error){var callback,_i,_len,_ref;for(_ref=this._onErrorCallbacks,_i=0,_len=_ref.length;_len>_i;_i++)(callback=_ref[_i])(error);throw error},Oblique}(),ObliqueNS.Oblique=Oblique,this.Oblique=Oblique,this.ObliqueNS=this.ObliqueNS||{},ObliqueError=function(_super){function ObliqueError(message){return this.message=message,this===window?new Error(this.message):void(this.name="ObliqueNS.Error")}return __extends(ObliqueError,_super),ObliqueError}(Error),ObliqueNS.Error=ObliqueError,this.ObliqueNS=this.ObliqueNS||{},Template=function(){function Template(templateContent){this.compiledTemplate=Handlebars.compile(templateContent)}return Template.prototype.renderHTML=function(model){return this.compiledTemplate(model)},Template}(),ObliqueNS.Template=Template,this.ObliqueNS=this.ObliqueNS||{},TemplateFactory=function(){function TemplateFactory(){}return Template=ObliqueNS.Template,TemplateFactory.prototype.createFromString=function(templateStr){return new Template(templateStr)},TemplateFactory.prototype.createFromDOMElement=function(element){return this.createFromString($(element).html())},TemplateFactory.prototype.createFromUrl=function(url){var errorMessage,errorStatusCode,template,templateContent;if(templateContent=void 0,errorStatusCode=200,errorMessage=void 0,jQuery.ajax({url:url,success:function(data){return templateContent=data},error:function(e){return errorStatusCode=e.status,errorMessage=e.statusCode},async:!1}),404===errorStatusCode)throw new ObliqueNS.Error("template '"+url+"' not found");if(200!==errorStatusCode)throw new ObliqueNS.Error(errorMessage);return template=this.createFromString(templateContent)},TemplateFactory}(),ObliqueNS.TemplateFactory=TemplateFactory,this.ObliqueNS=this.ObliqueNS||{},TimedDOMObserver=function(){function TimedDOMObserver(intervalInMs){this.intervalInMs=intervalInMs,this._intervalId=void 0,this._callback=function(){}}return TimedDOMObserver.prototype.onChange=function(callback){return this._callback=callback},TimedDOMObserver.prototype.getIntervalInMs=function(){return this.intervalInMs},TimedDOMObserver.prototype.observe=function(){return this._intervalId=setInterval(function(_this){return function(){return _this._callback()}}(this),this.intervalInMs)},TimedDOMObserver.prototype.destroy=function(){return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0},TimedDOMObserver}(),ObliqueNS.TimedDOMObserver=TimedDOMObserver}).call(this);