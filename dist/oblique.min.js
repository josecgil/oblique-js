(function(){var DirectiveCollection,DirectiveProcessor,Element,Error,JSON,NamedParams,Oblique,ObliqueError,Param,Template,TemplateFactory,TimedDOMObserver,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};this.ObliqueNS=this.ObliqueNS||{},DirectiveCollection=function(){function DirectiveCollection(){this.directives=[],this._cssExpressions=[]}return DirectiveCollection.prototype.count=function(){return this.directives.length},DirectiveCollection.prototype._isAFunction=function(memberToTest){return"function"==typeof memberToTest},DirectiveCollection.NOT_A_FUNCTION_CLASS_ERROR_MESSAGE="registerDirective must be called with a Directive 'Constructor/Class'",DirectiveCollection.DOESNT_HAVE_PROPERTY_CSS_EXPR_MESSAGE="directive must has an static CSS_EXPRESSION property",DirectiveCollection.prototype._throwErrorIfDirectiveIsNotValid=function(directive){if(!this._isAFunction(directive))throw new ObliqueNS.Error(ObliqueNS.DirectiveCollection.NOT_A_FUNCTION_CLASS_ERROR_MESSAGE);if(!directive.CSS_EXPRESSION)throw new ObliqueNS.Error(ObliqueNS.DirectiveCollection.DOESNT_HAVE_PROPERTY_CSS_EXPR_MESSAGE)},DirectiveCollection.prototype._hashCode=function(str){var chr,hash,i,len;if(hash=0,i=void 0,chr=void 0,len=void 0,0===str.length)return hash;for(i=0,len=str.length;len>i;)chr=str.charCodeAt(i),hash=(hash<<5)-hash+chr,hash|=0,i++;return hash},DirectiveCollection.prototype.add=function(directive){return this._throwErrorIfDirectiveIsNotValid(directive),directive.hashCode=this._hashCode(directive.toString()+directive.CSS_EXPRESSION).toString(),this.directives.push(directive),this._buildCSSExpressions()},DirectiveCollection.prototype.at=function(index){return this.directives[index]},DirectiveCollection.prototype._containsCssExpr=function(exprToSearch,exprArray){var expr,_i,_len;for(_i=0,_len=exprArray.length;_len>_i;_i++)if(expr=exprArray[_i],exprToSearch===expr)return!0;return!1},DirectiveCollection.prototype._buildCSSExpressions=function(){var cssExpr,directive,_i,_len,_ref,_results;for(this._cssExpressions=[],_ref=this.directives,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)directive=_ref[_i],cssExpr=directive.CSS_EXPRESSION,this._containsCssExpr(cssExpr,this._cssExpressions)||_results.push(this._cssExpressions.push(cssExpr));return _results},DirectiveCollection.prototype.getCSSExpressions=function(){return this._cssExpressions},DirectiveCollection.prototype.getDirectivesByCSSExpression=function(cssExpression){var cssExpr,directive,directivesWithCSSExpr,_i,_len,_ref;for(directivesWithCSSExpr=[],_ref=this.directives,_i=0,_len=_ref.length;_len>_i;_i++)directive=_ref[_i],cssExpr=directive.CSS_EXPRESSION,cssExpr===cssExpression&&directivesWithCSSExpr.push(directive);return directivesWithCSSExpr},DirectiveCollection}(),ObliqueNS.DirectiveCollection=DirectiveCollection,this.ObliqueNS=this.ObliqueNS||{},DirectiveProcessor=function(){function DirectiveProcessor(){return this===window?new DirectiveProcessor:DirectiveProcessor._singletonInstance?DirectiveProcessor._singletonInstance:(DirectiveProcessor._singletonInstance=this,this._throwErrorIfJQueryIsntLoaded(),this._directiveCollection=new ObliqueNS.DirectiveCollection,this._timedDOMObserver=this._createTimedDOMObserver(DirectiveProcessor.DEFAULT_INTERVAL_MS),void jQuery(document).ready(function(_this){return function(){return _this._applyDirectivesInDOM(),_this._timedDOMObserver.observe()}}(this)))}return DirectiveProcessor.DEFAULT_INTERVAL_MS=500,DirectiveProcessor.prototype._throwErrorIfJQueryIsntLoaded=function(){if(!window.jQuery)throw new Error("DirectiveProcessor needs jQuery to work")},DirectiveProcessor.prototype._createTimedDOMObserver=function(intervalInMs){var observer;return observer=new ObliqueNS.TimedDOMObserver(intervalInMs),observer.onChange(function(_this){return function(){return _this._applyDirectivesInDOM()}}(this)),observer},DirectiveProcessor._isApplyingDirectivesInDOM=!1,DirectiveProcessor.prototype._applyDirectivesInDOM=function(){var rootDOMElement,rootElement;if(!this._isApplyingDirectivesInDOM){this._isApplyingDirectivesInDOM=!0;try{return rootDOMElement=document.getElementsByTagName("body")[0],rootElement=new ObliqueNS.Element(rootDOMElement),rootElement.eachDescendant(function(_this){return function(DOMElement){var cssExpr,directive,directiveHashCode,model,obElement,_i,_len,_ref,_results;for(obElement=new ObliqueNS.Element(DOMElement),_ref=_this._directiveCollection.getCSSExpressions(),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)cssExpr=_ref[_i],obElement.matchCSSExpression(cssExpr)&&_results.push(function(){var _j,_len1,_ref1,_results1;for(_ref1=this._directiveCollection.getDirectivesByCSSExpression(cssExpr),_results1=[],_j=0,_len1=_ref1.length;_len1>_j;_j++)directive=_ref1[_j],directiveHashCode=directive.hashCode,obElement.hasFlag(directiveHashCode)||(obElement.setFlag(directiveHashCode),model=this._getModel(obElement),_results1.push(new directive(DOMElement,model)));return _results1}.call(_this));return _results}}(this))}finally{this._isApplyingDirectivesInDOM=!1}}},DirectiveProcessor.prototype._getModel=function(obElement){var dataModelExpr,model;if(model=Oblique().getModel(),!model)return void 0;if(dataModelExpr=obElement.getAttributeValue("data-model"),void 0===dataModelExpr)return void 0;if("this"===dataModelExpr)return model;try{return new ObliqueNS.JSON(model).getPathValue(dataModelExpr)}catch(_error){return this._throwError(obElement.getHtml()+": data-model doesn't match any data in model")}},DirectiveProcessor.prototype._throwError=function(errorMessage){return Oblique().triggerOnError(new ObliqueNS.Error(errorMessage))},DirectiveProcessor.prototype.getIntervalTimeInMs=function(){return this._timedDOMObserver.getIntervalInMs()},DirectiveProcessor.prototype.setIntervalTimeInMs=function(newIntervalTimeInMs){if(0>=newIntervalTimeInMs)throw new ObliqueNS.Error("IntervalTime must be a positive number");return this._timedDOMObserver.destroy(),this._timedDOMObserver=this._createTimedDOMObserver(newIntervalTimeInMs),this._timedDOMObserver.observe()},DirectiveProcessor.prototype.registerDirective=function(directiveConstructorFn){return this._directiveCollection.add(directiveConstructorFn)},DirectiveProcessor.prototype.destroy=function(){var e;this._timedDOMObserver.destroy();try{return delete DirectiveProcessor._singletonInstance}catch(_error){return e=_error,DirectiveProcessor._singletonInstance=void 0}},DirectiveProcessor}(),ObliqueNS.DirectiveProcessor=DirectiveProcessor,this.Oblique=DirectiveProcessor,this.ObliqueNS=this.ObliqueNS||{},Element=function(){function Element(DOMElement){this._jQueryElement=jQuery(DOMElement)}return Element.prototype._getDOMElement=function(){return this._jQueryElement.get(0)},Element.prototype.isTag=function(){return Element._isTag(this._DOMElement)},Element.prototype.matchCSSExpression=function(cssExpression){return this._jQueryElement.is(cssExpression)},Element.prototype.setFlag=function(flagName){return this._jQueryElement.data(flagName,!0)},Element.prototype.unsetFlag=function(flagName){return this._jQueryElement.removeData(flagName)},Element.prototype.hasFlag=function(flagName){return this._jQueryElement.data(flagName)},Element.prototype.hasAttribute=function(attributeName){var attrValue;return attrValue=this.getAttributeValue(attributeName),void 0===attrValue?!1:!0},Element.prototype.getAttributeValue=function(attributeName){return this._jQueryElement.attr(attributeName)},Element.prototype.eachDescendant=function(callbackOnDOMElement){return Element._traverse(this._getDOMElement(),callbackOnDOMElement)},Element._isTag=function(DOMElement){return 1===DOMElement.nodeType},Element._traverse=function(parentElement,callbackOnDOMElement){var child,currentElement,elementsToTraverse,_results;for(elementsToTraverse=[],Element._isTag(parentElement)&&elementsToTraverse.push(parentElement),callbackOnDOMElement(parentElement),_results=[];elementsToTraverse.length>0;)currentElement=elementsToTraverse.pop(),_results.push(function(){var _i,_len,_ref,_results1;for(_ref=currentElement.children,_results1=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],Element._isTag(child)?(elementsToTraverse.push(child),_results1.push(callbackOnDOMElement(child))):_results1.push(void 0);return _results1}());return _results},Element.prototype.getHtml=function(){return this._getDOMElement().outerHTML},Element}(),ObliqueNS.Element=Element,this.ObliqueNS=this.ObliqueNS||{},Error=function(){function Error(message){return this.message=message,this===window?new Error(this.message):void(this.name="Oblique.Error")}return Error}(),ObliqueNS.Error=Error,this.ObliqueNS=this.ObliqueNS||{},JSON=function(){function JSON(value){this.value=value}return JSON.prototype.getPathValue=function(path){var part,parts,value,_i,_len;for(parts=path.split("."),value=this.value,_i=0,_len=parts.length;_len>_i;_i++){if(part=parts[_i],!value.hasOwnProperty(part))throw new ObliqueNS.Error("'"+path+"' not found in JSON Object");value=value[part]}return value},JSON}(),ObliqueNS.JSON=JSON,this.ObliqueNS=this.ObliqueNS||{},Param=ObliqueNS.Param,NamedParams=function(){function NamedParams(params,paramSeparator,valueSeparator){var param,_i,_len,_ref;for(null==paramSeparator&&(paramSeparator=";"),null==valueSeparator&&(valueSeparator=":"),this.params=[],_ref=params.split(paramSeparator),_i=0,_len=_ref.length;_len>_i;_i++)param=_ref[_i],this.params.push(new Param(param,valueSeparator))}return NamedParams.prototype.getParam=function(paramName){var param,_i,_len,_ref;for(_ref=this.params,_i=0,_len=_ref.length;_len>_i;_i++)if(param=_ref[_i],param.name===paramName)return param;return null},NamedParams}(),ObliqueNS.NamedParams=NamedParams,this.ObliqueNS=this.ObliqueNS||{},Oblique=function(){function Oblique(){return this===window?new Oblique:Oblique._singletonInstance?Oblique._singletonInstance:(Oblique._singletonInstance=this,this.directiveProcessor=new ObliqueNS.DirectiveProcessor,this.templateFactory=new ObliqueNS.TemplateFactory,void(this._onErrorCallback=function(){}))}return Oblique.DEFAULT_INTERVAL_MS=500,Oblique.prototype.getIntervalTimeInMs=function(){return this.directiveProcessor.getIntervalTimeInMs()},Oblique.prototype.setIntervalTimeInMs=function(newIntervalTimeInMs){return this.directiveProcessor.setIntervalTimeInMs(newIntervalTimeInMs)},Oblique.prototype.registerDirective=function(directiveConstructorFn){return this.directiveProcessor.registerDirective(directiveConstructorFn)},Oblique.prototype.destroy=function(){var e;this.directiveProcessor.destroy();try{return delete Oblique._singletonInstance}catch(_error){return e=_error,Oblique._singletonInstance=void 0}},Oblique.prototype.setModel=function(_model){this._model=_model},Oblique.prototype.getModel=function(){return this._model},Oblique.prototype.hasModel=function(){return this._model?!0:!1},Oblique.prototype.renderHtml=function(url,model){var template;return template=this.templateFactory.createFromUrl(url),template.renderHTML(model)},Oblique.prototype.onError=function(_onErrorCallback){this._onErrorCallback=_onErrorCallback},Oblique.prototype.triggerOnError=function(error){throw this._onErrorCallback(error),error},Oblique}(),ObliqueNS.Oblique=Oblique,this.Oblique=Oblique,this.ObliqueNS=this.ObliqueNS||{},ObliqueError=function(_super){function ObliqueError(message){return this.message=message,this===window?new Error(this.message):void(this.name="ObliqueNS.Error")}return __extends(ObliqueError,_super),ObliqueError}(Error),ObliqueNS.Error=ObliqueError,this.ObliqueNS=this.ObliqueNS||{},Param=function(){function Param(param,valueSeparator){var paramAndValue;null==valueSeparator&&(valueSeparator=":"),paramAndValue=param.split(valueSeparator),this.name=paramAndValue[0].trim(),this.value=paramAndValue[1].trim()}return Param.prototype.valueAsInt=function(){return parseInt(this.value,10)},Param}(),ObliqueNS.Param=Param,this.ObliqueNS=this.ObliqueNS||{},Template=function(){function Template(templateContent){this.compiledTemplate=Handlebars.compile(templateContent)}return Template.prototype.renderHTML=function(model){return this.compiledTemplate(model)},Template}(),ObliqueNS.Template=Template,this.ObliqueNS=this.ObliqueNS||{},TemplateFactory=function(){function TemplateFactory(){}return Template=ObliqueNS.Template,TemplateFactory.prototype.createFromString=function(templateStr){return new Template(templateStr)},TemplateFactory.prototype.createFromDOMElement=function(element){return this.createFromString($(element).html())},TemplateFactory.prototype.createFromUrl=function(url){var errorMessage,errorStatusCode,template,templateContent;switch(templateContent=void 0,errorStatusCode=200,errorMessage=void 0,jQuery.ajax({url:url,success:function(){return function(data){return templateContent=data}}(this),error:function(e){return errorStatusCode=e.status,errorMessage=e.statusCode},async:!1}),errorStatusCode){case 404:throw new ObliqueNS.Error("template '"+url+"' not found");case!1:throw new ObliqueNS.Error(errorMessage)}return template=this.createFromString(templateContent)},TemplateFactory}(),ObliqueNS.TemplateFactory=TemplateFactory,this.ObliqueNS=this.ObliqueNS||{},TimedDOMObserver=function(){function TimedDOMObserver(intervalInMs){this.intervalInMs=intervalInMs,this._intervalId=void 0,this._callback=function(){}}return TimedDOMObserver.prototype.onChange=function(callback){return this._callback=callback},TimedDOMObserver.prototype.getIntervalInMs=function(){return this.intervalInMs},TimedDOMObserver.prototype.observe=function(){return this._intervalId=setInterval(function(_this){return function(){return _this._callback()}}(this),this.intervalInMs)},TimedDOMObserver.prototype.destroy=function(){return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0},TimedDOMObserver}(),ObliqueNS.TimedDOMObserver=TimedDOMObserver}).call(this);